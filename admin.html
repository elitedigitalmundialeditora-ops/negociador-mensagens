<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Painel Admin - Descontos Avançados</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="firebase.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<h2>Painel Avançado — Configuração de Descontos</h2>
<table>
    <thead>
        <tr>
            <th>Setor</th>
            <th>Atraso<br>(min / padrão / máx)</th>
            <th>Junção<br>(min / padrão / máx)</th>
            <th>Quitação<br>(min / padrão / máx)</th>
            <th>Observações</th>
            <th>Ação</th>
        </tr>
    </thead>
    <tbody id="tabelaConfig"></tbody>
</table>
<script>
const setores = ["play1", "play2", "play3", "play6"];
async function carregarConfigs() {
    const tbody = document.getElementById("tabelaConfig");
    tbody.innerHTML = "";
    for (let setor of setores) {
        const doc = await db.collection("config_avancado").doc(setor).get();
        const cfg = doc.exists ? doc.data() : {};
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td><b>${setor.toUpperCase()}</b></td>
            <td>
                <input type="number" id="${setor}-atrasoMin" value="${cfg.atrasoMin || 0}" style="width:60px;">
                <input type="number" id="${setor}-atrasoPadrao" value="${cfg.atrasoPadrao || 0}" style="width:60px;">
                <input type="number" id="${setor}-atrasoMax" value="${cfg.atrasoMax || 0}" style="width:60px;">
            </td>
            <td>
                <input type="number" id="${setor}-juncaoMin" value="${cfg.juncaoMin || 0}" style="width:60px;">
                <input type="number" id="${setor}-juncaoPadrao" value="${cfg.juncaoPadrao || 0}" style="width:60px;">
                <input type="number" id="${setor}-juncaoMax" value="${cfg.juncaoMax || 0}" style="width:60px;">
            </td>
            <td>
                <input type="number" id="${setor}-quitacaoMin" value="${cfg.quitacaoMin || 0}" style="width:60px;">
                <input type="number" id="${setor}-quitacaoPadrao" value="${cfg.quitacaoPadrao || 0}" style="width:60px;">
                <input type="number" id="${setor}-quitacaoMax" value="${cfg.quitacaoMax || 0}" style="width:60px;">
            </td>
            <td>
                <textarea id="${setor}-obs" rows="2" cols="25">${cfg.obs || ""}</textarea>
            </td>
            <td>
                <button onclick="salvar('${setor}')">Salvar</button>
            </td>
        `;
        tbody.appendChild(tr);
    }
}
async function salvar(setor) {
    const atrasoMin = Number(document.getElementById(`${setor}-atrasoMin`).value);
    const atrasoPadrao = Number(document.getElementById(`${setor}-atrasoPadrao`).value);
    const atrasoMax = Number(document.getElementById(`${setor}-atrasoMax`).value);
    const jMin = Number(document.getElementById(`${setor}-juncaoMin`).value);
    const jPadrao = Number(document.getElementById(`${setor}-juncaoPadrao`).value);
    const jMax = Number(document.getElementById(`${setor}-juncaoMax`).value);
    const qMin = Number(document.getElementById(`${setor}-quitacaoMin`).value);
    const qPadrao = Number(document.getElementById(`${setor}-quitacaoPadrao`).value);
    const qMax = Number(document.getElementById(`${setor}-quitacaoMax`).value);
    const obs = document.getElementById(`${setor}-obs`).value;
    if (atrasoMin > atrasoPadrao || atrasoPadrao > atrasoMax) return alert("❌ Desconto de Atraso inválido.");
    if (jMin > jPadrao || jPadrao > jMax) return alert("❌ Desconto de Junção inválido.");
    if (qMin > qPadrao || qPadrao > qMax) return alert("❌ Desconto de Quitação inválido.");
    await db.collection("config_avancado").doc(setor).set({
        atrasoMin, atrasoPadrao, atrasoMax,
        juncaoMin: jMin, juncaoPadrao: jPadrao, juncaoMax: jMax,
        quitacaoMin: qMin, quitacaoPadrao: qPadrao, quitacaoMax: qMax,
        obs
    }, { merge: true });
    alert(`✔ Configurações atualizadas para ${setor.toUpperCase()}`);
}
window.onload = carregarConfigs;
</script>
</body>
</html>
